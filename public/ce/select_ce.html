<template>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

	<style>
		
	</style>
		<div class="input-group mb-3">
			<select class="custom-select">
			  <option disabled selected value="">v√§lj...</option>
			  <option value="1">One</option>
			  <option value="2">Two</option>
			  <option value="3">Three</option>
			  <option value="4">Four</option>
			  <option value="5">Five</option>
			</select>
		  </div>
	
</template>

<script>
(function(window, document, undefined) {

	var thatDoc = document;
	var thisDoc = (thatDoc._currentScript || thatDoc.currentScript).ownerDocument;

	class SelectCE extends CustomElement {

		constructor() {
			super();
			this.thatDoc = thatDoc;
			this.thisDoc = thisDoc;
			this.extend();
		}


			
		static get observedAttributes() {

			return [ 'selectedindex', 'value'];

		}

		extendView(that) {
			this.view.renderSelectedIndex = function(obj) {
				console.log(that.shadowRoot.querySelector('select').children[obj]);
				Array.prototype.slice.call(that.shadowRoot.querySelector('select')).forEach(child => {
					
					child.removeAttribute('selected');
					console.log(child);
				})
				console.log('obj');
				console.log(obj);
				that.shadowRoot.querySelector('select').children[obj].setAttribute('selected', 'selected');
				console.log(that.shadowRoot.querySelector('select').children[obj]);
			};

			this.view.updatedSelectedIndex = function() {
				that.view.renderSelectedIndex.call(that, that.model.getSelectedIndex());
			};
		}

		extendCtrl(that) {
			let parent;

			this.ctrl.run = function() {
				console.log('ONRUN1');
				console.log(that.selectedindex);
				if (that.selectedindex !== null && that.selectedindex !== undefined && that.selectedindex !== "") {
					console.log('ONRUN2');
				console.log(that.selectedindex);
					that.view.renderSelectedIndex(that.selectedindex);
				}
			};

			//local - from user
			this.ctrl.useraction = function(e) {
				console.log('theE');
				console.log(e);
				console.log(e.detail.composedPath()[0]);
				that.selectedindex = e.detail.composedPath()[0].selectedIndex;
				that.model.updateSelectedIndex(that.selectedindex);
			};

			//local - from model
			this.ctrl.updatedSelectedIndex = function() {
				that.view.updatedSelectedIndex();
				console.log('the parent');
				console.log(parent);
				if (parent !== undefined) {
					console.log('I have a parent');
					eventDispatcher(parent.eventTarget, 'updatedselectedindexfromchild', that); 
				} else {
					console.log('No parent...');
				}
				
			};


			// this.ctrl.clearedSelectedIndex = function() {
			// 	that.view.updatedSelectedIndex();
			// 	eventDispatcher(e.detail.eventTarget, 'clearedselectfromchild');
			// 	//console.log("clearedValue");
			// };



			//parent
			this.ctrl.selectedindexfromparent = function(e) {
				parent = e.detail;
				console.log('e');
				console.log(e);
				that.selectedindex = e.detail.selectedindex;
				console.log('that.selectedindex');
				console.log(that.selectedindex);
				that.model.updateSelectedIndex(that.selectedindex);
			};

			// this.ctrl.clearfromparent = function(e) {
			// 	console.log('clear from parent');
			// 	console.log('END STATION - SELECT');
			// 	that.selectedindex = "0"
			// 	that.value = "0"
			// 	that.model.updateSelectedIndex(that.selectedindex);
			// };

			//global
			// this.ctrl.clearfield = function(e) {
			// 	that.selectedindex = "0"
			// 	that.value = "0"
			// 	that.model.updateSelectedIndex(that.selectedindex);
			// 	console.log("clearfield");
			// 	// console.log(e);
			// 	// that.value = e.detail.detail.changedAttribute.newVal;
			// 	// return that.model.changeHeadline(e);
			// };

		}

		extendModel(that) {
			let value = "";
			let selectedindex = "0";

			this.model.updateSelectedIndex = function(newIndex) {
				console.log('THENEWINDEX');
				console.log(newIndex);
				selectedindex = newIndex;
				eventDispatcher(that.eventTarget, 'updatedselectedindex');
			};

			this.model.getSelectedIndex = function() {
				console.log('THESELECTEDINDEX');
				console.log(selectedindex);
				return selectedindex;
			};

			this.model.getValue = function() {
				return value;
			};

			// this.model.clearValue = function() {
			// 	that.value = "";
			// 	value = "";
			// 	that.selectedindex = "0";
			// 	eventDispatcher(that.eventTarget, 'clearedselectedindex');
			// };


		}
	}

	window.customElements.define('select-ce', SelectCE);

})(window, document);
</script>

<script type="text/javascript" src="/js/curry.js"></script>
<script type="text/javascript" src="/js/helper.js"></script>
