<!-- 
	specific:
	Headline-ce is a low level component with no children.No slots.Does not report to parent.
	required attributes: headline-ce: title

	General notes:
	Preferrably query select by id.
	Set id on tags.
	All event names initiated by parent to be run by child should end with "FromParent".
	First line in functions initiated by parent should always start with: "parent = e.detail;"
	Model and View announce thru local events. Controller calls function in Model and View directly. If present controller announce to parent and child thru the parents and childrens local events.
	View is always passive.
 -->

<template>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<style>

	</style>

	<span id="headline"></span>
	
</template>

<script>
(function(window, document, undefined) {

	var thatDoc = document;
	var thisDoc = (thatDoc._currentScript || thatDoc.currentScript).ownerDocument;

	class HeadlineCE extends CustomElement {
		constructor() {
		super();
		this.thatDoc = thatDoc;
		this.thisDoc = thisDoc;
		this.extend();
		}

		static get observedAttributes() {
            return ['title'];
        };
		
		//Controller
		extendCtrl(that) {
			let parent;

			//init
			this.ctrl.run = function() {
				if (!h.boolean.isEmpty(that.title)) {
					that.view.render(that.title);
				}
			};	

			//local events - from model
			this.ctrl.updatedHeadline = function() {
				let headline = that.model.getHeadline();
				that.view.updatedHeadline(headline);
				
				if (parent !== undefined) {
					eventDispatcher(parent.eventTarget, 'updatedtitleattributefromchild', that);
				} else {
					console.log('No parent...');
				}
			};


			//initiated by parent
			this.ctrl.titleAttributeFromParent = function(e) {
				parent = e.detail;
				that.title = parent.title;
				that.model.updateModelWithTitleAttribute(that.title);
			};

			//global
			// this.ctrl.changeHeadline = function(e) {
			// 	that.title = e.detail.detail.changedAttribute.newVal;
			// 	return that.model.updateHeadline(that.title);
			// };


		}

		//View
		//always passive
		extendView(that) {
			this.view.render = function(obj) {
				that.shadowRoot.querySelector('#headline').textContent = obj;
			};

			this.view.updatedHeadline = function(headline) {
				that.view.render.call(that, headline);
			};
		}
		
		//Model
		extendModel(that) {
			let db = {};
			db.headline = "";

			this.model.updateModelWithTitleAttribute = function(newVal) {
				db.headline = newVal;
				eventDispatcher(that.eventTarget, 'updatedheadline'); 
			};

			this.model.getHeadline = function() {
				return db.headline;
			};
		}
	}
	
	window.customElements.define('headline-ce', HeadlineCE)

})(window, document);
</script>

<script type="text/javascript" src="/js/curry.js"></script>
<script type="text/javascript" src="/js/helper.js"></script>
