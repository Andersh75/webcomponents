<!-- 
	specific:
	required attributes: select-ce: selectedindex
	
	General notes:
	Preferrably query select by id.
	Set id on tags.
	All event names initiated by parent to be run by child should end with "FromParent".
	First line in functions initiated by parent should always start with: "parent = e.detail;"
	Model and View announce thru local events. Controller calls function in Model and View directly. If present controller announce to parent and child thru the parents and childrens local events.
	View is always passive.
	Always let parent in first line of extend ctrl.
 -->
<template>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

	<style>
		
	</style>
		<div class="input-group mb-3">
			<select id="select" class="custom-select">
			  <option disabled selected value="">v√§lj...</option>
			  <option value="1">One</option>
			  <option value="2">Two</option>
			  <option value="3">Three</option>
			  <option value="4">Four</option>
			  <option value="5">Five</option>
			</select>
		  </div>
	
</template>

<script>
(function(window, document, undefined) {

	var thatDoc = document;
	var thisDoc = (thatDoc._currentScript || thatDoc.currentScript).ownerDocument;

	class SelectCE extends CustomElement {

		constructor() {
			super();
			this.thatDoc = thatDoc;
			this.thisDoc = thisDoc;
			this.extend();
		}

		static get observedAttributes() {
			return [ 'selectedindex'];
		}

		
		//Controller
		extendCtrl(that) {
			let parent;
			
			//intit
			this.ctrl.run = function() {
				if (!h.boolean.isEmpty(that.selectedindex)) {
					that.view.updatedSelectedIndex(that.selectedindex);
				}
			};

			//local events - from user
			this.ctrl.useraction = function(e) {
				that.selectedindex = e.detail.composedPath()[0].selectedIndex;
				that.model.updateModelWithSelectedIndexAttribute(that.selectedindex);
			};

			//local events - from model
			this.ctrl.updatedSelectedIndex = function() {
				let selectedIndex = that.model.getSelectedIndex();
				
				that.view.updatedSelectedIndex(selectedIndex);
		
				if (parent !== undefined) {
					eventDispatcher(parent.eventTarget, 'updatedselectedindexattributefromchild', that); 
				} else {
					console.log('No parent...');
				}
				
			};


			// this.ctrl.clearedSelectedIndex = function() {
			// 	that.view.updatedSelectedIndex();
			// 	eventDispatcher(e.detail.eventTarget, 'clearedselectfromchild');
			// 	//console.log("clearedValue");
			// };



			//initiated by parent
			this.ctrl.selectedIndexAttributeFromParent = function(e) {
				parent = e.detail;
				that.selectedindex = parent.selectedindex;
				that.model.updateModelWithSelectedIndexAttribute(that.selectedindex);
			};

			this.ctrl.clearFromParent = function(e) {
				that.selectedindex = "0"
				that.model.updateModelWithSelectedIndexAttribute(that.selectedindex);
			};

			//global
			// this.ctrl.clearfield = function(e) {
			// 	that.selectedindex = "0"
			// 	that.value = "0"
			// 	that.model.updateSelectedIndex(that.selectedindex);
			// 	console.log("clearfield");
			// 	// console.log(e);
			// 	// that.value = e.detail.detail.changedAttribute.newVal;
			// 	// return that.model.changeHeadline(e);
			// };

		}
		

		//View
		//always passive
		extendView(that) {
			this.view.render = function(obj) {
				Array.prototype.slice.call(that.shadowRoot.querySelector('#select')).forEach(child => {
					child.removeAttribute('selected');
				})
				console.log(that.shadowRoot.querySelector('#select'));
				console.log(obj);
				that.shadowRoot.querySelector('#select').children[obj].setAttribute('selected', 'selected');
			};

			this.view.updatedSelectedIndex = function(selectedIndex) {
				
				that.view.render.call(that, selectedIndex);
			};
		}
		
		//Model
		extendModel(that) {
			let db ={};
			db.selectedIndex = "0";

			this.model.updateModelWithSelectedIndexAttribute = function(newVal) {
				db.selectedIndex = newVal;
				eventDispatcher(that.eventTarget, 'updatedselectedindex');
			};

			this.model.getSelectedIndex = function() {
				return db.selectedIndex;
			};


			// this.model.clearValue = function() {
			// 	that.value = "";
			// 	value = "";
			// 	that.selectedindex = "0";
			// 	eventDispatcher(that.eventTarget, 'clearedselectedindex');
			// };


		}
	}

	window.customElements.define('select-ce', SelectCE);

})(window, document);
</script>

<script type="text/javascript" src="/js/curry.js"></script>
<script type="text/javascript" src="/js/helper.js"></script>
